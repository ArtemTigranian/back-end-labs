{% extends "base2.html" %}

{% block lab %}Каталог товаров{% endblock %}

{% block script %}
<script>
    function addToCart(productId) {
        const url = '/lab10/json-rpc-api/';
        const json = {
            'jsonrpc': '2.0',
            'method': 'add_to_cart',
            'params': productId,
            'id': Math.round(Math.random() * 1000)
        };
        
        fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(json)
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error.message);
            } else {
                alert(data.result);
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        const productList = {{ products | tojson }};  // Передаем список продуктов из Python в JavaScript
        const ul = document.getElementById('product-list');
        ul.innerHTML = ''; // Очищаем список перед рендером

        // Создаем список товаров
        productList.forEach(product => {
            const li = document.createElement('li');
            li.classList.add('product-card');
            li.innerHTML = `
                <div class="product-info">
                    <h3 class="product-title">${product.title}</h3>
                    <p class="product-description">${product.description}</p>
                    <p class="product-price">${product.price} руб.</p>
                    <button class="add-to-cart-btn" onclick="addToCart(${product.id})">Добавить в корзину</button>
                </div>
            `;
            ul.appendChild(li);
        });
    });
</script>
{% endblock %}

{% block main %}
<style>
    /* Стили для списка товаров */
    .product-list {
        list-style-type: none;
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 20px;
        justify-content: center; /* Центрирование карточек */
    }

    /* Стили для карточки товара */
    .product-card {
        border: 2px solid #f8c8c8;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 15px;
        text-align: center;
        width: 200px;
        transition: transform 0.3s;
    }

    .product-card:hover {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .product-info {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .product-title {
        font-size: 15pt;
        font-weight: bold;
    }

    .product-description {
        font-size: 12pt;
        color: gray;
        margin-bottom: 10px;
    }

    .product-price {
        font-size: 15pt;
        color: #333;
        margin-bottom: 10px;
    }

    .add-to-cart-btn {
        background-color: rgb(0, 175, 0);  /* Зеленая кнопка */
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 7px;
        cursor: pointer;
        font-size: 12pt;
    }

    .add-to-cart-btn:hover {
        background-color: rgb(0, 150, 0);
    }
    .cart-btn{
        background-color: red;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 7px;
        cursor: pointer;
        font-size: 12pt;
    }
    .cart-btn:hover{
        background-color: rgb(200, 0, 0);
    }
    .menu-shop{
        text-align: center;
    }
</style>
<div class="menu-shop">
    <h1>Каталог товаров</h1>
    <a href="/lab10/cart"><button class="cart-btn">Перейти в корзину</button></a>
</div>

<ul id="product-list" class="product-list"></ul>

{% endblock %}
